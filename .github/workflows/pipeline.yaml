name: Basic Pipeline
run-name: ${{ github.actor }} - Pipeline Run #${{ github.run_number }} - ${{ github.workflow }}

# Permissions needed for the GITHUB_TOKEN to interact with the repo
permissions:
  contents: write    # Required to push changes (like to gh-pages)
  pull-requests: read

on:
  push:
    branches: ["develop", "main"]
  pull_request:
    branches: ["main"]

jobs:
  # JOB 1: System Check and Context Exploration
  # This job acts as a "Sanity Check" to display environment information.
  basic-checkout:
    runs-on: ubuntu-latest
    steps:
      - name: Display Event Information
        run: |
          echo "Event: ${{ github.event_name }}"
          echo "Branch: ${{ github.ref }}"
          echo "Runner OS: ${{ runner.os }}"
          echo "Commit Message: ${{ github.event.head_commit.message }}"

      - name: Checkout repository code
        uses: actions/checkout@v6.0.2

      - name: Post-Checkout Status
        run: |
          echo "Repository ${{ github.repository }} cloned successfully."
          echo "Current Job Status: ${{ job.status }}"

  # JOB 2: Validation and Quality Control
  # This job ensures the HTML/CSS code is valid before any further steps.
  verificate:
    runs-on: ubuntu-latest
    needs: basic-checkout # This job only starts if 'basic-checkout' succeeds
    steps:
      - name: Run HTML5 Validator
        # Checks syntax of HTML files. CSS validation is disabled as per your config.
        uses: Cyb3r-Jak3/html5validator-action@v7.2.0
        with:
          root: './'
          css: true
          skip_git_check: true
          format: json
          extra: '--match *.html'

      - name: Upload Validation Logs
        # Ensures logs are only saved if the validator finds errors
        if: failure()
        uses: actions/upload-artifact@v6.0.0
        with:
          name: validation-report
          path: html5validator.log
          retention-days: 7 # Kept for 7 days to save storage space

  # JOB 3: Manual Deployment (Simulation)
  # This job simulates a manual push to a deployment branch.
  deploy:
    runs-on: ubuntu-latest
    needs: verificate
    # Only runs on the 'main' branch to avoid deploying development code
    if: github.ref == 'refs/heads/main'
    steps:
      - name: Simulated Manual Deploy
        run: |
          echo "Starting Manual Deploy Process..."
          mkdir -p deploy_folder
          cp *.html deploy_folder/
          echo "Deployment artifacts prepared in deploy_folder/"
          
      - name: Deploy Success Message
        run: echo "Code from ${{ github.ref }} successfully validated and 'deployed'!"